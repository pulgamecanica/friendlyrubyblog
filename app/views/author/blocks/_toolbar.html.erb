<!-- Sticky Toolbar Column -->
<div data-block-editor-target="toolbar"
     class="sticky top-20 h-fit flex flex-col gap-3"
     id="<%= dom_id(block) %>_toolbar">

  <!-- Block Info -->
  <div class="bg-white rounded-lg border border-gray-200 p-4">
    <div class="text-xs font-medium text-gray-500 uppercase tracking-wider">
      <%= block.type %>
    </div>
    <%= render "author/blocks/position", block: block %>
  </div>

  <!-- Normal Mode Tools -->
  <div data-block-editor-target="normalTools"
       class="bg-white rounded-lg border border-gray-200 p-4 space-y-3 flex flex-col">

    <div class="flex gap-2">
      <button data-block-editor-target="collapseBtn"
              data-action="click->block-editor#toggleCollapse"
              class="flex-1 px-2 py-1.5 text-xs border border-gray-300 rounded hover:bg-gray-50 transition-colors">
        Collapse
      </button>

      <button class="drag-handle px-2 py-1.5 text-xs border border-gray-300 rounded hover:bg-gray-50 transition-colors cursor-move focus:outline-none focus:ring-0"
              title="Drag to reorder">
        <svg class="w-3 h-3 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
          <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"></path>
        </svg>
      </button>
    </div>

    <!-- Code Block Controls (only for CodeBlock) -->
    <% if block.is_a?(CodeBlock) %>
      <div class="border-t pt-3">
        <div class="text-xs font-medium text-gray-500 uppercase tracking-wider mb-2">
          Code Controls
        </div>

        <!-- Interactive Toggle -->
        <% if block.can_be_interactive? %>
          <%= form_with url: toggle_interactive_author_document_block_path(block.document, block),
                        method: :patch,
                        data: {
                          turbo_frame: "#{dom_id(block)}_toolbar",
                          turbo: true
                        },
                        local: false,
                        class: "mb-2" do |f| %>
            <div class="flex items-center justify-between">
              <span class="text-xs text-gray-700">Interactive Mode</span>
              <button type="submit"
                      class="<%= block.interactive? ? 'bg-blue-600' : 'bg-gray-300' %> relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                <span class="<%= block.interactive? ? 'translate-x-6' : 'translate-x-1' %> inline-block h-4 w-4 transform rounded-full bg-white transition-transform"></span>
              </button>
            </div>
          <% end %>
        <% end %>

        <!-- Run Button (only when interactive and supports execution) -->
        <% if block.supports_execution? %>
          <button data-action="click->code-executor#run"
                  data-block-id="<%= block.id %>"
                  class="w-full px-2 py-1.5 text-xs bg-green-600 text-white rounded hover:bg-green-700 transition-colors">
            ▶ Run Code
          </button>
        <% elsif block.interactive? %>
          <div class="text-xs text-gray-500 text-center py-1">
            Interactive mode enabled but execution not configured
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- Image Carousel Controls (only for ImageBlock with multiple images) -->
    <% if block.is_a?(ImageBlock) && block.images.count > 1 %>
      <div class="border-t pt-3">
        <div class="text-xs font-medium text-gray-500 uppercase tracking-wider mb-2">
          Image Navigation
        </div>
        <div class="flex gap-2">
          <button data-action="click->image-carousel#previous"
                  class="flex-1 px-2 py-1.5 text-xs border border-gray-300 rounded hover:bg-gray-50 transition-colors">
            ← Previous
          </button>
          <button data-action="click->image-carousel#next"
                  class="flex-1 px-2 py-1.5 text-xs border border-gray-300 rounded hover:bg-gray-50 transition-colors">
            Next →
          </button>
        </div>

        <!-- Image Indicators -->
        <div class="flex justify-center gap-1 mt-2">
          <% block.images.each_with_index do |_, index| %>
            <button data-action="click->image-carousel#goTo"
                    data-image-carousel-target="indicator"
                    data-index="<%= index %>"
                    class="w-2 h-2 rounded-full bg-gray-300 hover:bg-gray-500 transition-colors focus:outline-none focus:ring-0 <%= 'bg-gray-600' if index == 0 %>">
            </button>
          <% end %>
        </div>
      </div>
    <% end %>

    <%= button_to "Delete",
        author_document_block_path(block.document, block),
        method: :delete,
        form: { data: { turbo_confirm: "Delete this block?" } },
        class: "w-full px-2 py-1.5 text-xs border border-red-300 text-red-700 rounded hover:bg-red-50 transition-colors" %>
  </div>

  <!-- Edit Mode Tools -->
  <div data-block-editor-target="editTools"
       class="bg-white rounded-lg border border-gray-200 p-4 pt-2 flex flex-col gap-2"
       style="display: none;">
    <% if block.is_a?(MarkdownBlock) %>
      <div class="text-xs text-center text-gray-400">Markdown Preview</div>

      <div class="flex flex-row gap-1 pb-2 border-b border-gray-300">
        <button data-block-editor-target="previewBtn"
                data-action="click->block-editor#togglePreview"
                class="w-full px-2 py-1.5 text-xs border border-gray-300 rounded hover:bg-gray-50 transition-colors">
          Preview
        </button>

        <button data-block-editor-target="layoutBtn"
                data-action="click->block-editor#toggleLayout"
                class="w-full px-2 py-1.5 text-xs border border-gray-300 rounded hover:bg-gray-50 transition-colors">
          Layout
        </button>
      </div>
    <% end %>
    <button data-action="click->block-editor#exitEditMode"
            class="w-full px-2 py-2 text-xs bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors">
      Close
    </button>
  </div>

  <!-- Update Button (Edit Mode Only) -->
  <div data-block-editor-target="updateButton"
       class="bg-white rounded-lg border border-gray-200 p-4"
       style="display: none;">

    <button data-block-editor-target="submitButton"
            data-action="click->block-editor#submitForm"
            class="w-full px-3 py-2 text-xs bg-green-600 text-white rounded hover:bg-green-700 font-medium transition-colors">
      Update Block
    </button>
  </div>
</div>