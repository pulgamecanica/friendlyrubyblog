<%
  # Calculate version number relative to this block (most recent = highest number)
  version_number = block.versions.count - block.versions.reorder(created_at: :desc).index(version)
%>
<div class="border border-gray-200 dark:border-gray-700 rounded-lg p-3 <%= 'bg-blue-50 dark:bg-blue-900/20 border-blue-300 dark:border-blue-700' if is_current %>">
  <!-- Version Header -->
  <div class="flex items-center justify-between mb-2">
    <div class="flex items-center gap-2">
      <span class="text-xs font-semibold text-gray-900 dark:text-gray-100">
        v<%= version_number %>
      </span>
      <% if is_current %>
        <span class="text-xs px-2 py-0.5 bg-blue-600 text-white rounded">
          Current
        </span>
      <% end %>
    </div>
    <span class="text-xs text-gray-500 dark:text-gray-400">
      <%= time_ago_in_words(version.created_at) %> ago
    </span>
  </div>

  <!-- Version Details -->
  <div class="text-xs text-gray-600 dark:text-gray-300 mb-3">
    <% if version.event == 'create' %>
      <span class="text-green-600 dark:text-green-400">✓ Created</span>
    <% elsif version.event == 'update' %>
      <span class="text-blue-600 dark:text-blue-400">✎ Updated</span>
      <% if version.changeset.present? %>
        <span class="text-gray-500 dark:text-gray-400">
          (<%= version.changeset.keys.join(', ') %>)
        </span>
      <% end %>
    <% elsif version.event == 'destroy' %>
      <span class="text-red-600 dark:text-red-400">✗ Deleted</span>
    <% end %>
  </div>

  <!-- Actions -->
  <div class="flex gap-2"
       data-controller="block-version"
       data-block-version-preview-url-value="<%= preview_version_author_document_block_path(block.document, block, version) %>">
    <button data-action="click->block-version#preview"
            class="flex-1 px-2 py-1.5 text-xs text-center border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 dark:text-gray-300 transition-colors">
      Preview
    </button>

    <% unless is_current %>
      <%= button_to "Restore",
                    restore_version_author_document_block_path(block.document, block, version),
                    method: :patch,
                    data: {
                      turbo: true,
                      turbo_confirm: "Restore this version? This will revert the block to this state."
                    },
                    class: "flex-1 px-2 py-1.5 text-xs border border-blue-300 dark:border-blue-700 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-50 dark:hover:bg-blue-900/30 transition-colors" %>
    <% end %>
  </div>
</div>
