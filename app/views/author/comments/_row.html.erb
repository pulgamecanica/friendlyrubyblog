<% target = comment.commentable %>

<tr id="<%= dom_id(comment) %>" class="hover:bg-gray-50">
  <td class="px-6 py-4">
    <div class="text-sm text-gray-900 max-w-md">
      <%= simple_format(comment.body_markdown, class: "whitespace-pre-wrap") %>
    </div>
    <div class="mt-2 flex items-center gap-3 text-xs text-gray-500">
      <span class="flex items-center">
        <%= icon_clock size: :sm, class: "mr-1" %>
        <%= time_ago_in_words(comment.created_at) %> ago
      </span>
      <span class="flex items-center">
        <%= icon_shield size: :sm, class: "mr-1" %>
        IP: <%= comment.ip_hash&.first(8) %>
      </span>
    </div>
  </td>

  <td class="px-6 py-4 whitespace-nowrap">
    <% if target.is_a?(Document) %>
      <div class="text-sm">
        <%= link_to target.title, edit_author_document_path(target),
              class: "text-indigo-600 hover:text-indigo-900 font-medium" %>
      </div>
      <div class="text-xs text-gray-500">Document</div>
    <% else %>
      <div class="text-sm">
        <%= link_to target.document.title, edit_author_document_path(target.document),
              class: "text-indigo-600 hover:text-indigo-900 font-medium" %>
      </div>
      <div class="text-xs text-gray-500">
        Block #<%= target.position %> Â· <%= target.type.demodulize %>
      </div>
    <% end %>
  </td>

  <td class="px-6 py-4">
    <div class="text-sm font-medium text-gray-900">
      <%= comment.name.presence || "Anonymous" %>
    </div>
    <% if comment.email.present? %>
      <div class="text-xs text-gray-500"><%= comment.email %></div>
    <% end %>
    <% if comment.website.present? %>
      <div class="text-xs">
        <%= link_to safe_html(comment.website), safe_html(comment.website),
              rel: "nofollow noopener", target: "_blank",
              class: "text-indigo-600 hover:text-indigo-900" %>
      </div>
    <% end %>
  </td>

  <td class="px-6 py-4">
    <% badge_classes = {
      "visible" => "bg-green-100 text-green-800",
      "pending" => "bg-yellow-100 text-yellow-800",
      "hidden" => "bg-gray-200 text-gray-700"
    }[comment.status] || "bg-gray-200 text-gray-700" %>

    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium <%= badge_classes %> mb-2">
      <%= comment.status.capitalize %>
    </span>

    <%= form_with model: [:author, comment], method: :patch,
          data: { turbo_stream: true },
          class: "flex items-center gap-2 mt-2" do |f| %>
      <%= f.select :status,
            options_for_select([%w[visible visible], %w[pending pending], %w[hidden hidden]], comment.status),
            {}, class: "block rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-xs py-1 px-2" %>
      <%= f.submit "Update", class: "inline-flex items-center px-2 py-1 border border-transparent rounded-md text-xs font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" %>
    <% end %>
  </td>

  <td class="px-6 py-4 text-right whitespace-nowrap">
    <%= button_to author_comment_path(comment), method: :delete,
          form: { data: { turbo_confirm: "Delete this comment?" } },
          class: "inline-flex items-center text-red-600 hover:text-red-900" do %>
      <%= icon_trash size: :md %>
    <% end %>
  </td>
</tr>
