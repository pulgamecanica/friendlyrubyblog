<% content_for :title, "Editing Â· #{@document.title}" %>

<div class="min-h-screen bg-gray-50 dark:bg-gray-900" data-controller="editor-width">
  <!-- Sticky Header -->
  <%= render "header", document: @document %>

  <!-- Main Content -->
  <div class="flex flex-col">
    <!-- Document Metadata Section (Collapsible) -->
    <%= render "metadata_section", document: @document %>

    <!-- Document Blocks Section -->
    <div class="flex-1 px-6 py-6">
      <div class="mx-auto max-w-6xl" data-editor-width-target="container">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Content Blocks</h2>
        </div>

        <div id="blocks"
             class="space-y-2"
             data-controller="drag-sort"
             data-drag-sort-document-id-value="<%= @document.id %>"
             data-drag-sort-sort-url-value="<%= sort_author_document_blocks_path(@document) %>">
          <%= turbo_frame_tag "blocks" do %>
            <%= render "author/blocks/blocks_with_inserts", blocks: @blocks, document: @document %>
          <% end %>
        </div>

        <% if @document.blocks.empty? %>
        <!-- New Block Form -->
        <div class="mt-8 p-6 bg-white dark:bg-gray-800 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600">
          <turbo-frame id="new_block">
            <%= render "author/blocks/form", document: @document, block: Block.new(type: "MarkdownBlock") %>
          </turbo-frame>
        </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
