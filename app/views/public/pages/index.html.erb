<% content_for :title, "pages" %>

<div class="mb-8 pb-4 border-b border-gray-200 dark:border-gray-800">
  <h1 class="text-2xl font-normal text-gray-700 dark:text-gray-400 font-mono"># pages</h1>
</div>

<!-- Pages by Series -->
<div class="space-y-8">
  <% Series.order(:title).each do |series| %>
    <% pages = series.documents.published.pages.order(:series_position) %>
    <% next if pages.empty? %>

    <div class="overflow-hidden border border-gray-300 dark:border-gray-800 bg-white dark:bg-gray-900" data-controller="collapsible" data-collapsible-expanded-value="true">
      <!-- Series Header (Collapsible) -->
      <button type="button"
              data-action="click->collapsible#toggle"
              data-collapsible-target="toggle"
              class="w-full flex items-center justify-between px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors group">
        <div class="flex items-center gap-3">
          <span class="text-green-600 dark:text-green-500 font-mono">~</span>
          <div class="text-left">
            <h2 class="text-base font-normal text-gray-900 dark:text-gray-200 group-hover:text-green-600 dark:group-hover:text-green-500 transition-colors font-mono">
              <%= series.title %>
            </h2>
            <p class="text-xs text-gray-500 dark:text-gray-600 font-mono mt-0.5">
              <%= pages.count %> <%= 'page'.pluralize(pages.count) %>
            </p>
          </div>
        </div>

        <!-- Chevron -->
        <svg data-collapsible-target="icon"
             class="h-4 w-4 text-gray-400 dark:text-gray-600 transition-transform duration-200"
             fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </button>

      <!-- Pages List (Collapsible Content) -->
      <div data-collapsible-target="content" class="border-t border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-800">
        <% pages.each_with_index do |page, index| %>
          <%= link_to public_page_path(page), class: "group flex items-center justify-between px-4 py-3 border-l-2 border-transparent hover:border-green-500 hover:bg-gray-100 dark:hover:bg-gray-800/70 transition-all #{index.odd? ? 'bg-gray-50 dark:bg-gray-900/75' : 'bg-white dark:bg-gray-900'}" do %>
            <div class="flex items-center gap-3 flex-1 min-w-0">
              <div class="flex-1 min-w-0">
                <p class="text-sm font-normal text-gray-900 dark:text-gray-200 group-hover:text-green-600 dark:group-hover:text-green-500 transition-colors truncate">
                  <%= page.title %>
                </p>
                <% if page.description.present? %>
                  <p class="text-xs text-gray-500 dark:text-gray-600 truncate mt-0.5">
                    <%= page.description %>
                  </p>
                <% end %>
              </div>
            </div>

            <div class="flex items-center gap-3">
              <% if page.tags.any? %>
                <div class="hidden lg:flex flex-wrap gap-2 font-mono text-xs">
                  <% page.tags.limit(3).each do |tag| %>
                    <span class="text-gray-500 dark:text-gray-600">
                      #<%= tag.title %>
                    </span>
                  <% end %>
                </div>
              <% end %>

              <span class="text-xs font-mono text-green-600 dark:text-green-500 group-hover:text-green-700 dark:group-hover:text-green-400 transition-colors">
                â†’
              </span>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<% if @documents.empty? %>
  <div class="text-center py-12 font-mono">
    <p class="text-gray-500 dark:text-gray-600 text-sm">nothing here yet...</p>
  </div>
<% end %>
