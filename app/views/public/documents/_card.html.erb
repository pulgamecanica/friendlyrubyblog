<%
  # Only use specific routes for published documents
  # Unpublished documents always use generic document_path
  path = if doc.published?
    case doc.kind
    when "post" then public_post_path(doc)
    when "page" then public_page_path(doc)
    when "note" then public_note_path(doc)
    else public_document_path(doc)
    end
  else
    public_document_path(doc)
  end
%>
<article class="group relative h-full border border-gray-300 dark:border-gray-800 bg-white dark:bg-gray-900 transition-colors hover:border-green-500 dark:hover:border-green-500 cursor-pointer overflow-hidden" onclick="window.location='<%= path %>'">
  <!-- Image -->
  <% if doc.portrait.attached? %>
    <div class="w-full h-48 overflow-hidden bg-gray-100 dark:bg-gray-800">
      <%= image_tag doc.portrait, class: "w-full h-full object-cover", alt: doc.title %>
    </div>
  <% elsif doc.series && doc.series.portrait.attached? && doc.series_position.present? %>
    <div class="relative w-full h-48 overflow-hidden bg-gray-100 dark:bg-gray-800">
      <%= image_tag doc.series.portrait, class: "w-full h-full object-cover opacity-40", alt: doc.series.title %>
      <div class="absolute inset-0 flex items-center justify-center">
        <span class="text-6xl font-mono font-bold text-gray-700 dark:text-gray-300">
          <%= doc.series_position %>
        </span>
      </div>
    </div>
  <% end %>

  <div class="relative p-5">
    <!-- Series Badge -->
    <% if doc.series %>
      <div class="mb-3 inline-flex items-center gap-1 text-xs font-mono text-gray-600 dark:text-gray-500">
        <span class="text-green-600 dark:text-green-500">~</span>
        <%= doc.series.title %>
      </div>
    <% end %>

    <!-- Title -->
    <h2 class="text-lg font-normal text-gray-900 dark:text-gray-200 mb-3 group-hover:text-green-600 dark:group-hover:text-green-500 transition-colors line-clamp-2">
      <%= doc.title %>
    </h2>

    <!-- Description -->
    <p class="text-sm text-gray-600 dark:text-gray-500 line-clamp-3 mb-4 leading-relaxed">
      <%= doc.description.presence || "..." %>
    </p>

    <!-- Tags -->
    <% if doc.tags.any? %>
      <div class="flex flex-wrap gap-2 mb-4 font-mono text-xs" onclick="event.stopPropagation()">
        <% doc.tags.limit(4).each do |t| %>
          <%= link_to public_tag_path(t), class: "text-gray-500 dark:text-gray-600 hover:text-green-600 dark:hover:text-green-500 transition-colors" do %>
            #<%= t.title %>
          <% end %>
        <% end %>
        <% if doc.tags.count > 4 %>
          <span class="text-gray-500 dark:text-gray-600">
            +<%= doc.tags.count - 4 %>
          </span>
        <% end %>
      </div>
    <% end %>

    <!-- Footer -->
    <div class="flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-800">
      <div class="flex items-center gap-2 text-xs font-mono text-gray-500 dark:text-gray-600">
        <% if doc.published_at.present? %>
          <time datetime="<%= doc.published_at.iso8601 %>">
            <%= time_ago_in_words(doc.published_at) %> ago
          </time>
        <% elsif doc.published %>
          <time datetime="<%= doc.created_at.iso8601 %>">
            <%= time_ago_in_words(doc.created_at) %> ago
          </time>
        <% else %>
          <span>draft</span>
        <% end %>
      </div>

      <!-- Read more indicator -->
      <div class="text-xs font-mono text-green-600 dark:text-green-500 group-hover:text-green-700 dark:group-hover:text-green-400 transition-colors">
        â†’
      </div>
    </div>
  </div>
</article>
